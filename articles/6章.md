## review





如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密。   
如果用私有密钥对数据进行加密，只有用对应的公开密钥才能解密。  



## 6-1 http 与 https

http 的缺点：

	明文传输，不够安全，相当于在网络上裸奔

	传输信息可能会中间人，拦截，或者篡改，中间人攻击


对称加密  
	
	加密和解密相同的密码
	缺点：第一次约定加密方式，携带秘钥，仍然会泄露
	保存和管理密钥十分复杂，安全地传送密钥也十分困难。
非对称加密
	
	有两个密钥，一个用来加密一个用来解密，并且不能根据与一个密钥来推算出另一个密钥，比较安全，但实现起来比较复杂。
	
	公开密钥和私有密钥是一对  
	如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密。   
	如果用私有密钥对数据进行加密，只有用对应的公开密钥才能解密。  
	因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。  
	
	即：  
	
	1. A要向B发送信息，A和B都要产生一对用于加密和解密的公钥和私钥
	2. A的私钥保密，A的公钥告诉B；B的私钥保密，B的公钥告诉A。
	3. A要给B发送信息时，A用B的公钥加密信息，因为A知道B的公钥。
	4. A将这个消息发给B（已经用B的公钥加密消息）。
	5. B收到这个消息后，B用自己的私钥解密A的消息。其他所有收到这个报文的人都无法解密，因为只有B才有B的私钥。


> https非对称加密的通信：

A(key1)B(key2)	

	首先B告诉A自己的公钥，A使用公钥key2 加密自己的 key1( 随机生成）
	B 使用key2 私钥解密，得到A的公钥。  
	之后，AB就可以使用 key1 进行对称解密通信



> 非对称加密的劫持：（发生在第一次通信，交换公钥的时候

A（公钥key2），B（公钥key1）

C （公钥key3）, 使用公钥key3向 A发信息，  
A 使用 key3 加密key2 ，发给 C  
C使用自己的私钥解密，得到 key2，再使用 key1 加密 key2 发给 B



证书原理：
	
	与数字签名相关的一个概念就是证书机制了，证书是用来做什么呢？在上面的各种模式中，我们一直使用了这样一个假设，就是接收方或者发送方所持有的、对方的公钥总是正确的（确实是对方公布的）。
	
	而实际上除非对方手把手将公钥交给我们，否则如果不采取措施，双方在网络中传递公钥时，一样有可能被篡改。
	
	那么怎样解决这个问题呢？这时就需要证书机制了：
	
	可以引入一个公正的第三方，当某一方想要发布公钥时，它将自身的身份信息及公钥提交给这个第三方，
	第三方对其身份进行证实，如果没有问题，则将其信息和公钥打包成为证书（Certificate)。
	而这个公正的第三方，就是常说的证书颁发机构（Certificate Authority）。
	当我们需要获取公钥时，只需要获得其证书，然后从中提取出公钥就可以了。


引入证书后的信息交流：

B（客户端）(key2) <—— A(服务端）(key1)

	A 把自己申请的证书给B， B验证证书的真伪， 解密获得A的公钥 key1  
	
	B然后使用A的公钥加密 B的公钥key2，发送给A  
	A通过自己的私钥解密，得到B的公钥，以后变可以使用 客户端的公钥（key2)进行对称加密。
	

## 6-2 https 协议概述


1. HTTPS = HTTP + TLS

	TLS 是传输层加密协议，前身是 SSL 协议（1995 年之后，改为 TLS 协议）




2. TLS 建立在应用层和传输层之间

	应用层，http  
	TSL  
	传输层，tcp  
	网络层，ip  
	数据链路层  
	物理层  




3. https 功能：
	
	

	1. 内容加密

	 		解决http明文传输内容，不安全、被篡改的隐患，
	 		
	 		step1: 非对称密钥交换
	 		step2: 对称加密
	 		

	2. 身份验证

			由于证书的存在，证书保证了用户访问的是想访问的网址。
	3. 数据完整性
			
			防止内容被篡改


4. https 如何使用数字证书 进行身份验证？


		1. 服务端向权威机构申请证书，客户端和服务端通信时，服务端先把证书传递给客户端，
		2. 客户端先用证书机构的公钥解密证书签名，然后 用hash算法 再生成一个消息摘要，对比一致说明公钥没有被修改
		3. 如果是真证书，浏览器中随机生成一对对称秘钥，并使用公钥 key1（服务器端的）加密该对称秘钥 key2，将它和对称加密后的URL一起发送到服务器
		
Q:
	
客户端如何验证证书有效性？以及服务端的公钥没有被修改过？
	
	服务端将自己的公钥，通过hash算法，生成消息摘要，给了CA机构，CA机构使用私钥加密，得到 数字签名
	将服务端的公钥等信息和签名合在一起发送给客户端，数字证书
	
	客户端使用CA公钥解密，如果消息摘要一致，则服务端公钥没有被修改
	后面就是，客户端随机生成对称秘钥，并且使用服务端的公钥加密，后续使用对称秘钥通信
	
数字签名和数字证书有什么不同？

	服务端的公钥和个人信息 +  数字签名 = 数字证书
![img](http://mmbiz.qpic.cn/mmbiz_png/KyXfCrME6UJFk4ma5Y5g5wIeggZaCZ3xviaVAYDBOyh06flLQcibdyVHiawCDRyjBOZ8kA40kMoQk4WPydvq0U9hA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

<a href="http://mmbiz.qpic.cn/mmbiz_png/KyXfCrME6UJFk4ma5Y5g5wIeggZaCZ3xviaVAYDBOyh06flLQcibdyVHiawCDRyjBOZ8kA40kMoQk4WPydvq0U9hA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1">图片</a>





## 6-3 https使用成本


百度2014年开始推动，国内的企业并没有全站部署https，只是在一些，账户，或者交易的子页面，子请求上部署了 https

成本：

1. 证书费用以及更新维护
2.  https 降低用户访问速度，毕竟多了一层。
3.  消耗cpu资源，需要增加大量机器（非对称交换秘钥，对称加密，对称解密）


虽然增加使用成本，但只要合理优化，增加的成本不是很大。  
在未来，肯定会更多的网站会使用的。



## 6-4 https 对性能的影响


> 网络耗时

1. 协议交互所增加的网络 RTT（往返时延，发送数据开始到 服务端接受确认 时延

2. 加解密增加的时间耗时


在第二次握手结束后，客户端发起 http get ，服务端302 跳转到 https 新链接

新链接有要开始 三次握手验证。


> 计算耗时

1. 浏览器计算耗时（解析证书，密钥交换，加密解密
2. 服务端计算耗时（密钥交换，加密解密

## 6-5 https 常见问题


1. https 加密，是不是需要我在电脑上安装证书/保存密码 ？

	前面说到https加密协议=SSL / TLS+http协议，也就是说，网站从http升级为https的关键就在于SSL证书，网站安装SSL证书之后就可以从http升级为https，进行加密传输，保护网站数据安全了。
　　
　　一开始SSL证书的作用只简单的在于数据加密，随着技术的成熟，越来越多的附加作用延伸出来，更加的服务我们的网站需求。

步骤：
	
	1.进入此页面进行证书购买：https://www.aliyun.com/product/cas（可选择免费版）

	2.证书绑定域名此处需要与cdn处域名相互对应	
	
	3.进行阿里云解析并配置cname


2. https 并不能解决所有的劫持，但可以降低风险


## 6-6  实验（ todo， 主要讲 如何从http 升级到 https
